{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@sycho/flarum-lite-youtube/webpack/bootstrap","webpack://@sycho/flarum-lite-youtube/webpack/runtime/make namespace object","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/construct.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","webpack://@sycho/flarum-lite-youtube/lite-youtube.ts","webpack://@sycho/flarum-lite-youtube/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n  return _construct.apply(null, arguments);\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport setPrototypeOf from \"./setPrototypeOf.js\";\nimport isNativeFunction from \"./isNativeFunction.js\";\nimport construct from \"./construct.js\";\nexport default function _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n      _cache.set(Class, Wrapper);\n    }\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n  return _wrapNativeSuper(Class);\n}","export default function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}","/**\n *\n * The shadowDom / Intersection Observer version of Paul's concept:\n * https://github.com/paulirish/lite-youtube-embed\n *\n * A lightweight YouTube embed. Still should feel the same to the user, just\n * MUCH faster to initialize and paint.\n *\n * Thx to these as the inspiration\n *   https://storage.googleapis.com/amp-vs-non-amp/youtube-lazy.html\n *   https://autoplay-youtube-player.glitch.me/\n *\n * Once built it, I also found these (👍👍):\n *   https://github.com/ampproject/amphtml/blob/master/extensions/amp-youtube\n *   https://github.com/Daugilas/lazyYT https://github.com/vb/lazyframe\n */\nexport class LiteYTEmbed extends HTMLElement {\n  shadowRoot!: ShadowRoot;\n  private domRefFrame!: HTMLDivElement;\n  private domRefImg!: {\n    fallback: HTMLImageElement;\n    webp: HTMLSourceElement;\n    jpeg: HTMLSourceElement;\n  };\n  private domRefPlayButton!: HTMLButtonElement;\n  private static isPreconnected = false;\n  private isIframeLoaded = false;\n\n  constructor() {\n    super();\n    this.setupDom();\n  }\n\n  static get observedAttributes(): string[] {\n    return ['videoid', 'playlistid'];\n  }\n\n  connectedCallback(): void {\n    this.addEventListener('pointerover', LiteYTEmbed.warmConnections, {\n      once: true,\n    });\n\n    this.addEventListener('click', () => this.addIframe());\n  }\n\n  get videoId(): string {\n    return encodeURIComponent(this.getAttribute('videoid') || '');\n  }\n\n  set videoId(id: string) {\n    this.setAttribute('videoid', id);\n  }\n\n  get playlistId(): string {\n    return encodeURIComponent(this.getAttribute('playlistid') || '');\n  }\n\n  set playlistId(id: string) {\n    this.setAttribute('playlistid', id);\n  }\n\n  get videoTitle(): string {\n    return this.getAttribute('videotitle') || 'Video';\n  }\n\n  set videoTitle(title: string) {\n    this.setAttribute('videotitle', title);\n  }\n\n  get videoPlay(): string {\n    return this.getAttribute('videoPlay') || 'Play';\n  }\n\n  set videoPlay(name: string) {\n    this.setAttribute('videoPlay', name);\n  }\n\n  get videoStartAt(): string {\n    return this.getAttribute('videoStartAt') || '0';\n  }\n\n  get autoLoad(): boolean {\n    return this.hasAttribute('autoload');\n  }\n\n  get noCookie(): boolean {\n    return this.hasAttribute('nocookie');\n  }\n\n  get posterQuality(): string {\n    return this.getAttribute('posterquality') || 'hqdefault';\n  }\n\n  get posterLoading(): HTMLImageElement['loading'] {\n    return (\n      (this.getAttribute('posterloading') as HTMLImageElement['loading']) ||\n      'lazy'\n    );\n  }\n\n  get params(): string {\n    return `start=${this.videoStartAt}&${this.getAttribute('params')}`;\n  }\n\n  set params(opts: string) {\n    this.setAttribute('params', opts);\n  }\n\n  /**\n   * Define our shadowDOM for the component\n   */\n  private setupDom(): void {\n    const shadowDom = this.attachShadow({ mode: 'open' });\n    shadowDom.innerHTML = `\n      <style>\n        :host {\n          contain: content;\n          display: block;\n          position: relative;\n          width: 100%;\n          padding-bottom: calc(100% / (16 / 9));\n          --lyt-animation: all 0.2s cubic-bezier(0, 0, 0.2, 1);\n          --lyt-play-btn-default: #212121;\n          --lyt-play-btn-hover: #f00;\n        }\n\n        @media (max-width: 40em) {\n          :host([short]) {\n            padding-bottom: calc(100% / (9 / 16));\n          }\n        }\n\n        #frame, #fallbackPlaceholder, iframe {\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          left: 0;\n        }\n\n        #frame {\n          cursor: pointer;\n        }\n\n        #fallbackPlaceholder {\n          object-fit: cover;\n        }\n\n        #frame::before {\n          content: '';\n          display: block;\n          position: absolute;\n          top: 0;\n          background-image: linear-gradient(180deg, #111 -20%, transparent 90%);\n          height: 60px;\n          width: 100%;\n          transition: var(--lyt-animation);\n          z-index: 1;\n        }\n\n        #playButton {\n          width: 70px;\n          height: 46px;\n          background-color: var(--lyt-play-btn-hover);\n          z-index: 1;\n          opacity: 0.8;\n          border-radius: 14%;\n          transition: var(--lyt-animation);\n          border: 0;\n        }\n\n        #frame:hover > #playButton {\n          background-color: var(--lyt-play-btn-hover);\n          opacity: 1;\n        }\n\n        #playButton:before {\n          content: '';\n          border-style: solid;\n          border-width: 11px 0 11px 19px;\n          border-color: transparent transparent transparent #fff;\n        }\n\n        #playButton,\n        #playButton:before {\n          position: absolute;\n          top: 50%;\n          left: 50%;\n          transform: translate3d(-50%, -50%, 0);\n          cursor: inherit;\n        }\n\n        /* Post-click styles */\n        .activated {\n          cursor: unset;\n        }\n\n        #frame.activated::before,\n        #frame.activated > #playButton {\n          display: none;\n        }\n      </style>\n      <div id=\"frame\">\n        <picture>\n          <source id=\"webpPlaceholder\" type=\"image/webp\">\n          <source id=\"jpegPlaceholder\" type=\"image/jpeg\">\n          <img id=\"fallbackPlaceholder\" referrerpolicy=\"origin\" loading=\"lazy\">\n        </picture>\n        <button id=\"playButton\"></button>\n      </div>\n    `;\n    this.domRefFrame = shadowDom.querySelector<HTMLDivElement>('#frame')!;\n    this.domRefImg = {\n      fallback: shadowDom.querySelector('#fallbackPlaceholder')!,\n      webp: shadowDom.querySelector('#webpPlaceholder')!,\n      jpeg: shadowDom.querySelector('#jpegPlaceholder')!,\n    };\n    this.domRefPlayButton = shadowDom.querySelector('#playButton')!;\n  }\n\n  /**\n   * Parse our attributes and fire up some placeholders\n   */\n  private setupComponent(): void {\n    this.initImagePlaceholder();\n\n    this.domRefPlayButton.setAttribute(\n      'aria-label',\n      `${this.videoPlay}: ${this.videoTitle}`\n    );\n    this.setAttribute('title', `${this.videoPlay}: ${this.videoTitle}`);\n\n    if (this.autoLoad || this.isYouTubeShort()) {\n      this.initIntersectionObserver();\n    }\n  }\n\n  /**\n   * Lifecycle method that we use to listen for attribute changes to period\n   * @param {*} name\n   * @param {*} oldVal\n   * @param {*} newVal\n   */\n  attributeChangedCallback(\n    name: string,\n    oldVal: unknown,\n    newVal: unknown\n  ): void {\n    switch (name) {\n      case 'videoid':\n      case 'playlistid':\n      case 'videoTitle':\n      case 'videoPlay': {\n        if (oldVal !== newVal) {\n          this.setupComponent();\n\n          // if we have a previous iframe, remove it and the activated class\n          if (this.domRefFrame.classList.contains('activated')) {\n            this.domRefFrame.classList.remove('activated');\n            this.shadowRoot.querySelector('iframe')!.remove();\n            this.isIframeLoaded = false;\n          }\n        }\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Inject the iframe into the component body\n   * @param {boolean} isIntersectionObserver\n   */\n  private addIframe(isIntersectionObserver = false): void {\n    if (!this.isIframeLoaded) {\n      // Don't autoplay the intersection observer injection, it's weird\n      let autoplay = isIntersectionObserver ? 0 : 1;\n      const wantsNoCookie = this.noCookie ? '-nocookie' : '';\n      let embedTarget;\n      if (this.playlistId) {\n        embedTarget = `?listType=playlist&list=${this.playlistId}&`;\n      } else {\n        embedTarget = `${this.videoId}?`;\n      }\n\n      // Oh wait, you're a YouTube short, so let's try to make you more workable\n      if (this.isYouTubeShort()) {\n        this.params = `loop=1&mute=1&modestbranding=1&playsinline=1&rel=0&enablejsapi=1&playlist=${this.videoId}`;\n        autoplay = 1;\n      }\n\n      const iframeHTML = `\n<iframe frameborder=\"0\"\n  allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen\n  src=\"https://www.youtube${wantsNoCookie}.com/embed/${embedTarget}autoplay=${autoplay}&${this.params}\"\n></iframe>`;\n      this.domRefFrame.insertAdjacentHTML('beforeend', iframeHTML);\n      this.domRefFrame.classList.add('activated');\n      this.isIframeLoaded = true;\n      this.attemptShortAutoPlay();\n      this.dispatchEvent(\n        new CustomEvent('liteYoutubeIframeLoaded', {\n          detail: {\n            videoId: this.videoId,\n          },\n          bubbles: true,\n          cancelable: true,\n        })\n      );\n    }\n  }\n\n  /**\n   * Setup the placeholder image for the component\n   */\n  private initImagePlaceholder(): void {\n    // we don't know which image type to preload, so warm the connection\n    LiteYTEmbed.addPrefetch('preconnect', 'https://i.ytimg.com/');\n\n    const posterUrlWebp = `https://i.ytimg.com/vi_webp/${this.videoId}/${this.posterQuality}.webp`;\n    const posterUrlJpeg = `https://i.ytimg.com/vi/${this.videoId}/${this.posterQuality}.jpg`;\n    this.domRefImg.fallback.loading = this.posterLoading;\n    this.domRefImg.webp.srcset = posterUrlWebp;\n    this.domRefImg.jpeg.srcset = posterUrlJpeg;\n    this.domRefImg.fallback.src = posterUrlJpeg;\n    this.domRefImg.fallback.setAttribute(\n      'aria-label',\n      `${this.videoPlay}: ${this.videoTitle}`\n    );\n    this.domRefImg?.fallback?.setAttribute(\n      'alt',\n      `${this.videoPlay}: ${this.videoTitle}`\n    );\n  }\n\n  /**\n   * Setup the Intersection Observer to load the iframe when scrolled into view\n   */\n  private initIntersectionObserver(): void {\n    const options = {\n      root: null,\n      rootMargin: '0px',\n      threshold: 0,\n    };\n\n    const observer = new IntersectionObserver((entries, observer) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting && !this.isIframeLoaded) {\n          LiteYTEmbed.warmConnections();\n          this.addIframe(true);\n          observer.unobserve(this);\n        }\n      });\n    }, options);\n\n    observer.observe(this);\n  }\n\n  /**\n   * This is a terrible hack to attempt to get YouTube Short-like autoplay on\n   * mobile viewports. It's this way because:\n   * 1. YouTube's Iframe embed does not offer determinism when loading\n   * 2. Attempting to use onYouTubeIframeAPIReady() does not work in 99% of\n   *    cases\n   * 3. You can _technically_ load the Frame API library and do more advanced\n   *    things, but I don't want to burn the thread of the wire with its\n   *    shenanigans since this an edge case.\n   * @private\n   */\n  private attemptShortAutoPlay() {\n    if (this.isYouTubeShort()) {\n      setTimeout(() => {\n        this.shadowRoot\n          .querySelector('iframe')\n          ?.contentWindow?.postMessage(\n            '{\"event\":\"command\",\"func\":\"' + 'playVideo' + '\",\"args\":\"\"}',\n            '*'\n          );\n        // for youtube video recording demo\n      }, 2000);\n    }\n  }\n\n  /**\n   * A hacky attr check and viewport peek to see if we're going to try to enable\n   * a more friendly YouTube Short style loading\n   * @returns boolean\n   */\n  private isYouTubeShort(): boolean {\n    return (\n      this.getAttribute('short') === '' &&\n      window.matchMedia('(max-width: 40em)').matches\n    );\n  }\n\n  /**\n   * Add a <link rel={preload | preconnect} ...> to the head\n   * @param {string} kind\n   * @param {string} url\n   * @param {string} as\n   */\n  private static addPrefetch(kind: string, url: string): void {\n    const linkElem = document.createElement('link');\n    linkElem.rel = kind;\n    linkElem.href = url;\n    linkElem.crossOrigin = 'true';\n    document.head.append(linkElem);\n  }\n\n  /**\n   * Begin preconnecting to warm up the iframe load Since the embed's network\n   * requests load within its iframe, preload/prefetch'ing them outside the\n   * iframe will only cause double-downloads. So, the best we can do is warm up\n   * a few connections to origins that are in the critical path.\n   *\n   * Maybe `<link rel=preload as=document>` would work, but it's unsupported:\n   * http://crbug.com/593267 But TBH, I don't think it'll happen soon with Site\n   * Isolation and split caches adding serious complexity.\n   */\n  private static warmConnections(): void {\n    if (LiteYTEmbed.isPreconnected) return;\n    // Host that YT uses to serve JS needed by player, per amp-youtube\n    LiteYTEmbed.addPrefetch('preconnect', 'https://s.ytimg.com');\n\n    // The iframe document and most of its subresources come right off\n    // youtube.com\n    LiteYTEmbed.addPrefetch('preconnect', 'https://www.youtube.com');\n\n    // The botguard script is fetched off from google.com\n    LiteYTEmbed.addPrefetch('preconnect', 'https://www.google.com');\n\n    // TODO: Not certain if these ad related domains are in the critical path.\n    // Could verify with domain-specific throttling.\n    LiteYTEmbed.addPrefetch(\n      'preconnect',\n      'https://googleads.g.doubleclick.net'\n    );\n    LiteYTEmbed.addPrefetch('preconnect', 'https://static.doubleclick.net');\n    LiteYTEmbed.isPreconnected = true;\n  }\n}\n// Register custom element\ncustomElements.define('lite-youtube', LiteYTEmbed);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'lite-youtube': LiteYTEmbed;\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}"],"names":["__webpack_require__","exports","Symbol","toStringTag","Object","defineProperty","value","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_getPrototypeOf","getPrototypeOf","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","prototype","valueOf","call","e","_construct","Parent","args","Class","isNativeReflectConstruct","a","push","apply","instance","Function","arguments","_wrapNativeSuper","_cache","Map","undefined","fn","toString","indexOf","TypeError","has","get","set","Wrapper","this","constructor","create","LiteYTEmbed","subClass","superClass","isIframeLoaded","setupDom","Constructor","protoProps","staticProps","connectedCallback","addEventListener","warmConnections","once","addIframe","shadowDom","attachShadow","mode","innerHTML","domRefFrame","querySelector","domRefImg","fallback","webp","jpeg","domRefPlayButton","setupComponent","initImagePlaceholder","setAttribute","videoPlay","videoTitle","autoLoad","isYouTubeShort","initIntersectionObserver","attributeChangedCallback","name","oldVal","newVal","classList","contains","remove","shadowRoot","isIntersectionObserver","embedTarget","autoplay","wantsNoCookie","noCookie","playlistId","videoId","params","iframeHTML","insertAdjacentHTML","add","attemptShortAutoPlay","dispatchEvent","CustomEvent","detail","bubbles","cancelable","addPrefetch","posterUrlWebp","posterQuality","posterUrlJpeg","loading","posterLoading","srcset","src","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","unobserve","root","rootMargin","threshold","observe","setTimeout","contentWindow","postMessage","getAttribute","window","matchMedia","matches","kind","url","linkElem","document","createElement","rel","href","crossOrigin","head","append","isPreconnected","encodeURIComponent","id","title","hasAttribute","videoStartAt","opts","HTMLElement","customElements","define"],"sourceRoot":""}